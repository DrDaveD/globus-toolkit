dnl

AC_REVISION($Revision$)

AC_INIT(Makefile.am)

GLOBUS_INIT

AM_PROG_LIBTOOL

dnl config header goes here

dnl Initialize the automake rules the last argument
AM_INIT_AUTOMAKE($GPT_NAME, $GPT_VERSION)

dnl Build hooks for all 'builtin' modules
echo -n "Checking for builtin modules... "
MODULE_DIRS=
MODULE_SOURCES=
MODULE_HOOKS_DEC=
MODULE_HOOKS_DEF=
modules=`ls modules | grep -v CVS`
delim=
if test "X$modules" != "X" ; then
  echo
  for module in $modules ; do
    MODULE_DIRS="$MODULE_DIRS modules/$module"
        
    source="modules/${module}/globus_gridftp_server_${module}.c"
    MODULE_SOURCES="$MODULE_SOURCES $source"
    
    MODULE_HOOKS_DEC="$MODULE_HOOKS_DEC $delim globus_i_gridftp_server_${module}_module"
    MODULE_HOOKS_DEF="$MODULE_HOOKS_DEF $delim &globus_i_gridftp_server_${module}_module"
    delim=","
    echo "Including module: $module"
  done
else
  echo "none found"
fi

AC_SUBST(MODULE_DIRS)
AC_SUBST(MODULE_SOURCES)
AC_SUBST(MODULE_HOOKS_DEC)
AC_SUBST(MODULE_HOOKS_DEF)

dnl Build hooks for all 'builtin' commands
echo -n "Checking for builtin commands... "
COMMAND_DIRS=
COMMAND_SOURCES=
COMMAND_HOOKS_DEC=
COMMAND_HOOKS_DEF=
commands=`ls commands | grep -v CVS`
delim=
if test "X$commands" != "X" ; then
  echo
  for command in $commands ; do
    COMMAND_DIRS="$COMMAND_DIRS commands/$command"
        
    source="commands/${command}/globus_gridftp_server_${command}.c"
    COMMAND_SOURCES="$COMMAND_SOURCES $source"
    
    COMMAND_HOOKS_DEC="$COMMAND_HOOKS_DEC $delim globus_i_gridftp_server_${command}_command"
    COMMAND_HOOKS_DEF="$COMMAND_HOOKS_DEF $delim &globus_i_gridftp_server_${command}_command"
    delim=","
    echo "Including command: $command"
  done
else
  echo "none found"
fi

AC_SUBST(COMMAND_DIRS)
AC_SUBST(COMMAND_SOURCES)
AC_SUBST(COMMAND_HOOKS_DEC)
AC_SUBST(COMMAND_HOOKS_DEF)

LAC_DOXYGEN("../")

GLOBUS_FINALIZE

AC_OUTPUT(
	Makefile
	pkgdata/Makefile
	pkgdata/pkg_data_src.gpt
        Makefile
	doxygen/Makefile
	doxygen/Doxyfile
	doxygen/Doxyfile-internal
	version.h
dnl NOTE: do not put anything below this line!
