dnl

AC_REVISION($Revision$)
AC_INIT(Makefile.am)

GLOBUS_INIT

AM_PROG_LIBTOOL

dnl config header goes here

dnl Initialize the automake rules the last argument
AM_INIT_AUTOMAKE($GPT_NAME, $GPT_VERSION)

LAC_DOXYGEN("../", "", "$GLOBUS_LOCATION/sbin/globus-vararg-enums-doxygen-filter.pl")


AC_SUBST( SRB_PATH)
AC_SUBST( SRB_CFLAGS)
AC_SUBST( SRB_TRICK_INCLUDE2)

AC_ARG_WITH( srb-path,
[  --with-srb-path=DIR    location of srb ],
    CONFIG_SRB_PATH="${withval}", AC_MSG_ERROR( [must specify srb path: --with-srb-path] ))

AC_ARG_WITH( patched-srb,
[  --with-patched-srb ],
    PATCHED_SRB="yes", PATCHED_SRB="no")

SRB_PATH=${CONFIG_SRB_PATH}

mkfile=`mktemp -q /tmp/srb-dsi.XXXXXX`
echo "include ${SRB_PATH}/mk/mk.config" > $mkfile
echo "include ${SRB_PATH}/mk/mk.common" >> $mkfile
echo "all:" >> $mkfile
echo -e "\techo "  '$(MY_CFLAG) 1>&2' >> $mkfile
SRB_CFLAGS=`(make -f $mkfile > /dev/null ) 2>&1`
rm -f $mkfile

AM_CONFIG_HEADER(globus_srb_config.h:globus_srb_config.h.in)

if test "X$PATCHED_SRB" = "Xyes"; then
    AC_DEFINE(WITH_PATCHED_SRB)
fi

GLOBUS_FINALIZE

AC_CONFIG_FILES(
	Makefile
	pkgdata/Makefile
        doxygen/Makefile
        doxygen/Doxyfile 
        doxygen/Doxyfile-internal
	pkgdata/pkg_data_src.gpt
        version.h
)

AC_OUTPUT()
