AC_REVISION($Revision$)
AC_INIT(lsf.in)

# checking for the GLOBUS_LOCATION

if test "x$GLOBUS_LOCATION" = "x"; then
    echo "ERROR Please specify GLOBUS_LOCATION" >&2
    exit 1
fi

if test ! -n "${LSF_ENVDIR}"; then
    AC_MSG_WARN([Using default of /etc for LSF_ENVDIR])
    LSF_ENVDIR=/etc
fi

LSF_CONF_FILE="${LSF_ENVDIR}/lsf.conf"

if test ! -r "${LSF_CONF_FILE}"; then
    AC_MSG_ERROR([LSF configuration ${LSF_CONF_FILE} not found.])
fi

LSF_CONF=`sed -ne 's/LSF_CONFDIR=//p' < "${LSF_CONF_FILE}"`

if ! test -d "${LSF_CONF}/."; then
    AC_MSG_ERROR([Invalid LSF_CONF directory ${LSF_CONF}])
fi

LSF_PROFILE="${LSF_CONF}/profile.lsf" 
if test ! -r "${LSF_PROFILE}"; then
    AC_MSG_ERROR([LSF profile profile.lsf is not present in LSF_CONF dir.])
fi

AC_SUBST(LSF_PROFILE)

if test ! -n "${LSF_ENVDIR}"; then
    AC_MSG_WARN([Using default of /etc for LSF_ENVDIR])
    LSF_ENVDIR=/etc
fi

LSF_CONF_FILE="${LSF_ENVDIR}/lsf.conf"

if test ! -r "${LSF_CONF_FILE}"; then
    AC_MSG_ERROR([LSF configuration ${LSF_CONF_FILE} not found.])
fi

LSF_CONF=`sed -ne 's/LSF_CONFDIR=//p' < "${LSF_CONF_FILE}"`

if ! test -d "${LSF_CONF}/."; then
    AC_MSG_ERROR([Invalid LSF_CONF directory ${LSF_CONF}])
fi

LSF_PROFILE="${LSF_CONF}/profile.lsf" 
if test ! -r "${LSF_PROFILE}"; then
    AC_MSG_ERROR([LSF profile profile.lsf is not present in LSF_CONF dir.])
fi

AC_SUBST(LSF_PROFILE)

AC_PATH_PROG(MPIEXEC, mpiexec, no)
if test "$MPIEXEC" = "no" ; then
    AC_MSG_WARN([Cannot locate mpiexec])
fi

AC_PATH_PROG(MPIRUN, mpirun, no)
if test "$MPIRUN" = "no" ; then
    AC_MSG_WARN([Cannot locate mpirun])
fi

AC_PATH_PROG(BSUB, bsub, no)
if test "$BSUB" = "no" ; then
    AC_MSG_ERROR([Cannot locate bsub])
fi

AC_PATH_PROG(BQUEUES, bqueues, no)
if test "$BQUEUES" = "no"; then
    AC_MSG_ERROR([Cannot locate bqueues])
fi

AC_PATH_PROG(BJOBS, bjobs, no)
if test "$BJOBS" = "no"; then
    AC_MSG_ERROR([Cannot locate bjobs])
fi

AC_PATH_PROG(BKILL, bkill, no)
if test "$BKILL" = "no"; then
    AC_MSG_ERROR([Cannot locate bkill])
fi

AC_PATH_PROG(BHIST, bhist, no)
if test "$BHIST" = "no"; then
    AC_MSG_ERROR([Cannot locate bhist])
fi

# SoftEnv extension
AC_PATH_PROG(SOFT_MSC, soft-msc, no)
if test "$SOFT_MSC" = "no" ; then
    AC_MSG_ERROR("Cannot locate soft-msc")
fi

prefix='$(GLOBUS_LOCATION)'
exec_prefix='$(GLOBUS_LOCATION)'
libexecdir=${prefix}/libexec

AC_OUTPUT(
    lsf.pm:lsf.in
)
